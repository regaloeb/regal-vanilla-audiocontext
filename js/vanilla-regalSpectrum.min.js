var RegalSpectrum=function(e,t){var r=this;r.el="object"==typeof e?e:e.indexOf("#")>=0?document.getElementById(e.replace("#","")):document.querySelector(e);var i={spectreView:r.el.getAttribute("data-spectreView")&&""!=r.el.getAttribute("data-spectreView")?r.el.getAttribute("data-spectreView"):1,sinusoidView:r.el.getAttribute("data-sinusoidView")&&""!=r.el.getAttribute("data-sinusoidView")?r.el.getAttribute("data-sinusoidView"):1,circlesView:r.el.getAttribute("data-circlesView")&&""!=r.el.getAttribute("data-circlesView")?r.el.getAttribute("data-circlesView"):1,stopOthers:r.el.getAttribute("data-stopOthers")&&""!=r.el.getAttribute("data-stopOthers")?r.el.getAttribute("data-stopOthers"):1,autoPlay:r.el.getAttribute("data-autoplay")&&""!=r.el.getAttribute("data-autoplay")?r.el.getAttribute("data-autoplay"):0,color:r.el.getAttribute("data-color")&&""!=r.el.getAttribute("data-color")?r.el.getAttribute("data-color"):0,volumeView:r.el.getAttribute("data-volumeView")&&""!=r.el.getAttribute("data-volumeView")?r.el.getAttribute("data-volumeView"):1,loop:r.el.getAttribute("data-loop")&&""!=r.el.getAttribute("data-loop")?r.el.getAttribute("data-loop"):0,spectrumFft:r.el.getAttribute("data-spectrumFft")&&""!=r.el.getAttribute("data-spectrumFft")?r.el.getAttribute("data-spectrumFft"):256,sineWaveFft:r.el.getAttribute("data-sineWaveFft")&&""!=r.el.getAttribute("data-sineWaveFft")?r.el.getAttribute("data-sineWaveFft"):1024};if(r.el.getAttribute("data-values")){var l=r.el.getAttribute("data-values").replace(/'/g,'"');g=JSON.parse(l),i={spectreView:null!=g.spectreView?g.spectreView:i.spectreView,sinusoidView:null!=g.sinusoidView?g.sinusoidView:i.sinusoidView,circlesView:null!=g.circlesView?g.circlesView:i.circlesView,stopOthers:null!=g.stopOthers?g.stopOthers:i.stopOthers,autoPlay:null!=g.autoPlay?g.autoPlay:i.autoPlay,color:null!=g.color?g.color:i.color,volumeView:null!=g.volumeView?g.volumeView:i.volumeView,loop:null!=g.loop?g.loop:i.loop,spectrumFft:null!=g.spectrumFft?g.spectrumFft:i.spectrumFft,sineWaveFft:null!=g.sineWaveFft?g.sineWaveFft:i.sineWaveFft}}"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var l=arguments[i];if(null!=l)for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(r[n]=l[n])}return r}),r.o=Object.assign({},i,t),NodeList.prototype.forEach||(NodeList.prototype.forEach=Array.prototype.forEach),HTMLCollection.prototype.forEach||(HTMLCollection.prototype.forEach=Array.prototype.forEach);var n={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return n.Android()||n.BlackBerry()||n.iOS()||n.Opera()||n.Windows()}},o=window,a=document,c=a.documentElement,u=a.getElementsByTagName("body")[0],s=o.innerWidth||c.clientWidth||u.clientWidth,d=(o.innerHeight||c.clientHeight||u.clientHeight,o.pageYOffset,!0);window.AudioContext||(window.webkitAudioContext||(d=!1),window.AudioContext=window.webkitAudioContext);var f=function(){s=o.innerWidth||c.clientWidth||u.clientWidth,o.innerHeight||c.clientHeight||u.clientHeight,window.pageYOffset};f();var p,h,y,v,g,m=r.o.spectreView&&r.el.querySelector(".spectrum")?1:0,S=r.o.sinusoidView&&r.el.querySelector(".sineWave")?1:0,w=r.o.circlesView&&r.el.querySelector(".circles")?1:0,q=r.o.volumeView&&r.el.querySelector(".volume-canvas")?1:0,A=Math.round(255*Math.random()+0),b=Math.round(255*Math.random()+0),L=Math.round(255*Math.random()+0);if(i.color){var E=i.color.split(",");A=E[0],b=E[1],L=E[2]}var W,V=r.el.querySelector(".sourceSound"),C=function(){m&&(G=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,r.el.querySelectorAll(".spectrum").forEach(function(e){e.width=G})),S&&(H=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,r.el.querySelector(".sineWave").width=H),w&&(_=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,r.el.querySelector(".circles").width=_)},M=function(){var e,t,r,i,l;(v=k.createScriptProcessor(2048,1,1)).connect(k.destination),(y=k.createAnalyser()).smoothingTimeConstant=.3,(h=k.createMediaElementSource(V)).connect(y),y.connect(v),h.connect(k.destination),(l=(e=k).createScriptProcessor(512)).onaudioprocess=te,l.clipping=!1,l.lastClip=0,l.volume=0,l.clipLevel=t||.98,l.averaging=r||.95,l.clipLag=i||750,l.connect(e.destination),l.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},l.shutdown=function(){this.disconnect(),this.onaudioprocess=null},p=l,h.connect(p)},O=function(){if(V.play(),r.o.stopOthers&&document.querySelector(".spectrumSound.active")&&document.querySelector(".spectrumSound.active").querySelector(".play").dispatchEvent(new Event("click")),r.el.classList.add("active"),r.el.querySelector(".sourceSound").classList.contains("video")){r.el.querySelector(".sourceSound").classList.add("active");var e=parseInt(getComputedStyle(r.el.querySelector(".sourceSound")).height)+2*parseInt(r.el.querySelector(".sourceSound").style.paddingTop,10);r.el.style.height=e+"px"}P(),r.el.querySelector(".play").classList.remove("pause")},F=function(){V.pause(),r.el.classList.remove("active"),r.el.querySelector(".sourceSound").classList.contains("video")&&(r.el.querySelector(".sourceSound").classList.remove("active"),r.el.style.height="auto"),cancelAnimationFrame(W),r.el.querySelector(".play").classList.add("pause")},T=function(e){V.buffered.end(V.buffered.length-1);setTimeout(function(){V.currentTime=e},200)},x=function(e){V.volume=e},P=function(){d&&(W=requestAnimationFrame(P),S&&function(){y.fftSize=D,B=y.fftSize;var e=new Uint8Array(B);y.getByteTimeDomainData(e),R.clearRect(0,0,H,I),R.fillStyle="rgba(0, 0, 0, 0)",R.fillRect(0,0,H,I),R.lineWidth=10,R.strokeStyle="rgba("+(255-A)+", "+(255-b)+", "+(255-L)+", 0.5)",R.beginPath();for(var t=1*H/B,r=0,i=0;i<B;i++){var l=e[i]/128,n=l*I/2;0===i?R.moveTo(r,n):R.lineTo(r,n),r+=t}R.lineTo(H,I/2),R.stroke()}(),m&&function(){y.fftSize=N;var e=new Uint8Array(y.frequencyBinCount);y.getByteFrequencyData(e),Y&&(X.clearRect(0,0,G,z),X.fillStyle="rgba("+A+", "+b+", "+L+", 0.5)");J&&(K.clearRect(0,0,G,z),K.fillStyle="rgba("+A+", "+b+", "+L+", 0.5)");for(var t=0;t<e.length-U;t++){var r=e[t],i=r*j,l=t*(G/(e.length-U)*1)+1,n=G/(e.length-U)*1-1,o=i;Y&&X.fillRect(l,0,n,o),J&&K.fillRect(l,0,n,o)}}(),w&&function(){y.fftSize=$;var e=new Uint8Array(y.frequencyBinCount);y.getByteTimeDomainData(e),ee.clearRect(0,0,_,Z),ee.fillStyle="rgba("+A+", "+b+", "+L+", "+5/$+")";for(var t=V.currentTime/V.duration*_-parseInt(r.el.querySelector(".circles").offsetLeft,10),i=e.length-1;i>=0;i--){ee.beginPath();var l=e[i]*Q,n=Z/2;ee.arc(t,n,l,0,2*Math.PI),ee.fill()}}(),q&&function(){(ie=re.createLinearGradient(0,0,0,150)).addColorStop(1,"rgba("+A+", "+b+", "+L+", 1)"),ie.addColorStop(.75,"rgba("+A+", "+b+", "+L+", 0.7)"),ie.addColorStop(.25,"rgba("+A+", "+b+", "+L+", 0.5)"),ie.addColorStop(0,"rgba("+A+", "+b+", "+L+", 0.3)");var e=2*p.volume*150;re.clearRect(0,0,280,150),re.fillStyle=ie,re.fillRect(0,150-e,280,e)}())};if(d){window.context||(window.context=new AudioContext);var k=window.context;V.addEventListener("ended",function(){T(0),F(),i.loop&&O()},!1)}if(S){var B,R=r.el.querySelector(".sineWave").getContext("2d"),H=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,I=r.el.querySelector(".sineWave").height,D=r.o.sineWaveFft}if(m){var j=.5,z=parseInt(getComputedStyle(r.el.querySelector(".spectrum")).height),N=r.o.spectrumFft,U=N/2-Math.floor(N/2*71.8/100),G=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,Y=r.el.querySelector(".spectrumPos")?1:0,J=r.el.querySelector(".spectrumNeg")?1:0;if(Y)var X=r.el.querySelector(".spectrumPos").getContext("2d");if(J)var K=r.el.querySelector(".spectrumNeg").getContext("2d")}if(w){var Q=.25,Z=parseInt(getComputedStyle(r.el.querySelector(".circles")).height),$=32,_=r.el.querySelector(".timeline .container").clientWidth>0?r.el.querySelector(".timeline .container").clientWidth:s,ee=r.el.querySelector(".circles").getContext("2d")}function te(e){for(var t,r=e.inputBuffer.getChannelData(0),i=r.length,l=0,n=0;n<i;n++)t=r[n],Math.abs(t)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),l+=t*t;var o=Math.sqrt(l/i);this.volume=Math.max(o,this.volume*this.averaging)}if(q){var re=r.el.querySelector(".volume-canvas").getContext("2d"),ie=re.createLinearGradient(0,0,0,150)}var le=0,ne=function(){if(le>0&&Math.abs(le-V.currentTime)<.3)return!0;le=V.currentTime;var e=100/V.duration*V.currentTime+"%";r.el.querySelector(".timeline .progress .line .current").style.width=e;var t=V.currentTime,i=Math.floor(t/60),l=Math.floor(t%60);l.toString().length<2&&(l="0"+l),r.el.querySelector(".timeline .currentTime").innerHTML=i+":"+l;var n=V.duration-V.currentTime,o=Math.floor(n/60),a=Math.floor(n%60);a.toString().length<2&&(a="0"+a),r.el.querySelector(".timeline .remainingTime").innerHTML="- "+o+":"+a,r.el.querySelectorAll(".chapter-line").forEach(function(e){var r=e.getAttribute("data-time"),i=e.getAttribute("data-end");t>=parseFloat(r)?(e.classList.add("done"),e.classList.remove("active"),t<parseFloat(i)&&(e.classList.remove("done"),e.classList.add("active"))):(e.classList.remove("done"),e.classList.remove("active"))})};r.ready=!1,r.play=function(){O()},r.pause=function(){F()},r.seek=function(e){T(e)},r.setVolume=function(e){x(e)},r.changeColor=function(e){if(t){var t=e.split(",");A=t[0],b=t[1],L=t[2]}else A=Math.round(130*Math.random()+125),b=Math.round(130*Math.random()+125),L=Math.round(130*Math.random()+125)},window.addEventListener("resizeEnd",function(){f(),C()}),window.addEventListener("resize",function(){C()}),function(){if(m&&r.el.querySelectorAll(".spectrum").forEach(function(e){e.height=z,e.width=G}),S&&(r.el.querySelector(".sineWave").height=I,r.el.querySelector(".sineWave").width=H),w&&(r.el.querySelector(".circles").height=Z,r.el.querySelector(".circles").width=_),d){M();var e=!0;V.addEventListener("canplay",function(){if(e){e=!1,r.el.querySelectorAll(".chapter-line")&&r.el.querySelectorAll(".chapter-line").forEach(function(e){var t=100/V.duration*parseFloat(e.getAttribute("data-time"))+"%";e.style.left=t}),r.ready=!0;var t=-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome");!r.o.autoPlay||t||n.any()||O()}})}else o.addEventListener("load",function(){setTimeout(function(){r.el.querySelectorAll(".chapter-line")&&(r.el.querySelectorAll(".chapter-line").forEach(function(e){var t=100/V.duration*parseFloat(e.getAttribute("data-time"))+"%";e.style.left=t}),r.el.querySelectorAll(".chapters-line").forEach(function(e){e.style.display=""}))},500)}),r.ready=!0,r.el.querySelectorAll(".chapters-line").forEach(function(e){e.style.display="none"}),r.o.autoPlay&&O();r.el.querySelector(".sourceSound").addEventListener("timeupdate",function(){ne()}),r.el.querySelector(".timeline .progress").addEventListener("click",function(e){var t=e.clientX,i=r.el.querySelector(".container").getBoundingClientRect().left+document.body.scrollLeft,l=parseInt(getComputedStyle(r.el.querySelector(".timeline .progress .line")).width),n=V.duration*((t-i)/l);T(n),r.el.querySelector(".play").classList.contains("pause")&&r.el.querySelector(".play").dispatchEvent(new Event("click"))}),r.el.querySelector(".chapter")&&r.el.querySelector(".chapter").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=e.target.getAttribute("data-time");T(t),r.el.querySelector(".chapter.active").classList.remove("active"),e.target.classList.add("active")})}),r.el.querySelectorAll(".chapter-line")&&(r.el.querySelectorAll(".chapter-line").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=e.target.getAttribute("data-time");T(t)})}),r.el.querySelectorAll(".chapter-line").forEach(function(e,t){e.addEventListener("mouseover",function(e){var i=r.el.querySelectorAll(".chapter")[t];i&&i.classList.add("hover");var l=r.el.querySelector(".chapters-line-roll"),n=r.el.querySelector(".container").offsetLeft,o=e.target.offsetLeft-n;l.textContent=e.target.textContent,o+l.offsetWidth>r.el.querySelector(".container").offsetWidth&&(o=r.el.querySelector(".container").offsetWidth-l.offsetWidth),l.style.left=o+"px",l.classList.add("visible")}),e.addEventListener("mouseout",function(e){var i=r.el.querySelectorAll(".chapter")[t];i&&i.classList.remove("hover"),r.el.querySelector(".chapters-line-roll").classList.remove("visible")})})),r.el.querySelector(".play").addEventListener("click",function(e){e.target.classList.contains("pause")?O():F()}),r.el.querySelector(".volume").addEventListener("click",function(e){e.target.classList.contains("off")?(x(1),e.target.classList.remove("off")):(x(0),e.target.classList.add("off"))})}()};